# Social Media Database (PostgreSQL)

This container provides the PostgreSQL database for the social media dashboard. It includes schema for:
- users
- profiles
- posts
- engagements
- analytics_daily
- admin_flags

## Connection

The canonical connection info is stored in db_connection.txt and is generated by startup.sh. It looks like:
psql postgresql://appuser:dbuser123@localhost:5000/myapp

Backends should construct their connection using either:
- POSTGRES_URL (preferred if present), or
- POSTGRES_HOST, POSTGRES_PORT, POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB

See .env.example for required variables to be set by the orchestrator.

## Scripts

- startup.sh
  - Starts PostgreSQL (if not already running), creates DB/user, grants permissions.
  - Writes db_connection.txt and db_visualizer/postgres.env
  - Runs sql_init.sh to create schema and seed development data.

- sql_init.sh
  - Reads connection from db_connection.txt and executes:
    - CREATE TABLE statements for all entities
    - Indexes and constraints
    - Seed development data

- migrate.sh
  - Simple wrapper which runs sql_init.sh once and writes a marker file. Extend this to handle incremental migrations in future.

- backup_db.sh / restore_db.sh
  - Utility scripts to backup and restore the DB.

- db_visualizer/
  - Minimal Node viewer for quick table/data inspection. Source the env file to configure: `source db_visualizer/postgres.env`, then `npm start` inside db_visualizer folder.

## Backend wiring

Environment variables expected for the backend:
- POSTGRES_HOST
- POSTGRES_PORT
- POSTGRES_USER
- POSTGRES_PASSWORD
- POSTGRES_DB
- POSTGRES_URL (optional unified connection string)

Example connection string:
postgresql://appuser:dbuser123@localhost:5000/myapp

The analytics_daily table aggregates metrics per user per day. The admin_flags table provides simple toggle flags, e.g. enable_new_analytics.
